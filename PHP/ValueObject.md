# 값 객체

int, float, double, string 등의 프리미티브 타입과 심볼(클래스, 추상 클래스, 인터페이스)를 기반으로 한 타입이 존재한다.

어떤 값을 저장하는 타입으로 프리미티브 타입이 아닌 별도의 타입을 만들고 싶을 때 벨류 오브젝트를 사용한다.

## 커스텀 타입

흔히 객체지향 언어로 알고 있는 자바, C#, PHP 등에서 커스텀 타입을 만들 수 있는 방식은 클래스를 통해서 만들어야 한다.

커스텀 타입을 기존의 프리미티브 타입을 대신하게 하려면, 프리미티브 타입이 가지는 특성을 알 필요가 있다.

### 값의 독립성

어떤 변수에 3이란 값이 할당되어 있는데 5라는 값을 할당하자. 이 떄, 3이란 값 자체를 변경해서 5를 만드는 것은 아니다. 3이란 값과 5라는 값은 별개의 존재이다.

변수에 할당되는 것은 3이란 값이 변수에 할당한 것에서 5라는 값을 변수에 할당하는 것을 의미한다. 변수에 서로 다른 값을 할당하는 것으로 변수의 값을 변경한다.

서로 다른 곳에서 선언된 프리미티브 값은 동일한 메모리 데이터를 참조하지 않는다. 서로 다른 참조 메모리 참조 대상을 가진다. 동일한 값도 === 의 연산에 의해서 같다고 판별될 뿐, 코드에서 선언된 위치가 서로 다르다면 같은 값이라도 서로 다른 공간을 가진다.

이는 서로 다른 곳에서 선언된 두 값이 서로 영향을 주고 받는 것을 최대한 차단하기 위해서이고, 값이 복사되게 하기 위함이다. 값 객체는 오브젝트라서 참조가 되므로 이를 원시형의 값처럼 복사되게 할 수 없다. 따라서 불변성을 부여해서 참조가 되더라도 복사된 것과 마찬가지로 사용하도록 한다.

### 값의 일치성

서로 다른 위치에 3이란 값을 적었다면 이 두 3은 서로 다른 값이다. 하지만, 수로서는 동등하다. 이는 연산자 === 으로 동일성을 비교할 수 있고, 두 값의 크기를 < 와 > 연산자로 비교할 수 있다.

새로운 클래스로 값을 만들려고 할 때 두 값 객체를 비교할 수 있어야 한다. 이 비교를 위해서 연산자 === 를 대신할 수 있도록 isEqual 메소드를 정의하는 것이고, 필요하다면 서로간의 순서를 비교할 수 있는 비교를 위한 메소드를 정의할 수도 있다.

### 값의 불변성

프리미티브 타입의 값은 변수에 할당될 때 복사가 된다. 이에 반해, 객체는 변수에 할당될 때 참조가 되므로 객체를 가리키는 화살표가 저장된다.

값 객체에 어떤 메소드를 통해서 값 객체의 상태를 변경시킬 수 있다고 해 보자. 그러면 이 값 객체를 사용하고 있는 모든 값이 변경되는 것과 같다.

값처럼 행동하려면 복사가 되어야 하는데, 참조되어 동작하므로 변수에 할당된 시점의 값, 매개변수에 전달된 시점의 값을 보증할 수 없는 문제가 생긴다. 그래서 값 객체는 생성과 동시에 객체의 상태를 변경할 수 없는 불변성을 가지도록 정의되어야 한다.

### 도메인의 제약사항 나타내기

string은 문자열을 나타낸다. 이 문자열 타입은 도메인의 제약 사항을 잘 나타낼까? 어떤 도메인에서 날짜라는 개념을 사용한다고 하자. 기본적으로는 문자열로 날짜를 취급할 것이다. 또는 날짜 라이브러리를 사용해서 날짜를 취급할 수도 있을 것이다. 문제는 날짜 라이브러리를 사용하면, 날짜 정보 이외의 시, 분, 초 등의 불필요한 정보가 추가된다는 것이다. 문자열로 된 날짜만을 취급하고 싶은데, 불필요한 정보의 추가와 각종 날짜의 상태를 변경할 수 있는 다양한 메소드들이 존재하는 경우라면, 최초 선언된 값이 동일한 값인지 보증할 수 없다는 문제가 존재한다.

로직을 구성할 때 사용되는 문자열의 포멧이 yyyy-mm-dd의 문자열이라고 생각해 보자. 이 문자열은 특정 포멧의 날짜를 나타내고 있다. 어떤 값을 사용할 때 반드시 날짜 형식의 문자열만 존재하는 것을 보증하기 위해서 문자열을 대신해서 사용할 수 있는 방법을 생각해 보면, 왜 커스텀 타입을 정의하는 것을 고려해 볼 수 있다.

### 도메인과 타입

값은 그 자체로 타입을 가지고 있다. 변수는 값을 보관하는 곳으로 변수는 선언될 때의 타입을 통해서 변수에 할당될 타입을 제한할 수 있다. 변수에 타입 제한이 있기 때문에 변수를 사용할 때, 변수애 들어 있는 값에 어떤 코드를 연결해야 하는지 알 수 있다.

도메인의 제약사항을 나타낸 커스텀 타입을 사용하면, 변수가 가진 값이 어떤 값인지 변수의 타입을 통해 파악할 수 있고, 이를 통해서 어떤 코드와 연결해야 할지, 해당 코드에 어떤 조작을 해야할지를 파악하기 쉽다.

도메인의 제약을 나타낼 수 있는 방법은 타입 뿐만 아니라, 벨리데이션, 가드문, assert, 함수를 사용하는 것 등으로도 나타낼 수 있다. 타입을 사용하는 것은 도메인에서 자주 사용되는 제약사항을 표현한 것으로 이 제약사항을 타입으로 한 번 정의한 것을 통해서 제약사항을 검증하는 코드를 반복적으로 사용해야 하지만 이를 줄일 수 있다.

타입을 통해서 도메인의 제약 사항을 나타내게 되면, 타입은 내부의 값의 유효성을 보증할 수 있다. 이메일 값 객체라면 이메일 형식의 값이 들어 있는 것을 알 수 있고, 전화번호 값 객체라면 전화번호 형식의 값이 들어 있는 것을 알 수 있다. 이를 통해서, 타입의 이점을 사용할 수 있는데, 다양한 코드 시그니처에서 동일한 타입 베이스의 코드를 작성할 수 있으며, 다른 함수에 값을 전달할 때도 한 번 인스턴스화 한 값 오브젝트 그대로 전달해 주면 되기 때문에 일관된 타입을 통해서 코드를 전개할 수 있다는 장점이 존재한다.
