# 공통 식별자

공통으로 영향을 주는 문자열은 프로젝트 내에서 하나만 존재하도록 만드는 것이 좋다.

연관된 모든 코드를 쉽게 확인할 수 있을 때는 중복되는 코드를 써도 큰 문제가 없지만, 특정한 사람만이 아는 지식으로만 알 수 있거나, 문자열 변경이 어떤 영향을 초래하는지 쉽게 알 수 없는 경우에는, 문자열 변경이 어떤 영향을 끼치는지 알기 어렵기 때문에 데이터를 여러 곳에 나눠서 저장하는 것이 아닌 한 부분에 정의한 문자열을 이용하는 편이 좋다.

하지만, 동일한 문자열이라고 해서 함부로 변경할 수 있는 것은 아니다. 공통의 문자열을 정의해서 사용할 때는 가능한 공통 문자열을 한 번만 변경하도록 하여 각 기능들의 동작에 문제가 없도록 만들 필요가 있다. 공통 문자열을 변경했는데, 특정 코드에서는 성립되지 않는 코드가 존재할 수 있기 때문에 이런 경우 유의를 해 주어야 한다. 공통 문자열의 단순 변경이 아닌 특수한 문자열에 대한 특수한 처리를 수행하는 경우에는 주석 등을 사용하여 값이 바뀌면 특수한 변경을 해야 한다는 점을 언급하자.

## 공통 식별자 이용의 설계 방법

공통의 식별자 문자열을 사용한다고 해서 나눠져 있는 문자열을 공통 식별자로 함부로 바꿔서는 안 된다. 공통의 식별자를 변경했을 때 이를 사용하는 코드의 동작이 자연스럽지 않는다면 공통 식별자로 무리하게 변경하게 되면, 기존의 잘 동작하던 코드가 동작하지 않게 될 수 있다.

공통 식별자는 하나를 변경했을 때, 다른 부분도 함께 자연스럽게 변경 될 수 있도록 각각의 코드가 설계가 되어 있어야 한다. 그렇지 않다면 오히려 공통 식별자를 변경했을 때 버그나 에러가 발생할 수 있다. 특히 문자열 변경의 경우, 동일 타입 내에서의 변경이기 때문에, 실제로 달라지는 동작의 결과의 확인이 누락되면, 버그의 발견이 늦을 수 있기 때문에 문자열을 함부로 변경하는 것은 추천되지 않는다. 이 경우에는 중복 문자열을 사용하는 편이 나을 수 있다. IDE는 프로젝트에서 동일한 문자열을 찾는 기능을 제공하며, 각각의 코드에서의 문자열 변경이 초래하는 영향을 확인한 후 변경 사항을 반영하는 것이 옳다.

## config

라라벨에 보면 폴더 최상단에 `config`라는 폴더가 배치되어 있다. 이 폴더는 프로젝트를 구성하는데 필요한 각종 설정 옵션을 정하는 곳으로 이 값을 변경하면, 나머지 코드도 지정한 옵션명에 맞게 잘 동작 되어야 하는 곳이다.

많은 경우 흔히, 이 부분에 `config/const.php` 부분을 공통 상수를 정의하는 용도로 사용하곤 하는데, 각 항목의 값을 변경했을 때 초래되는 영향력을 고려하지 않고 무작정 상수를 정의하는 경우가 많다. 이 경우 기존의 상수 옵션을 함부로 바꿀 수 없는 경우가 생기게 되는 문제가 발생하기도 한다. 배열을 사용했다면, 해당 배열의 특수한 인덱스에 의존하기 보다는 키 값을 사용하거나, 배열을 순회하는 코드를 만들어 주어야 하고, 문자열의 경우에는 특수한 문자열에 대한 특수한 변경을 하는 코드와 가능한 함께 사용하지 않도록 설정하는 것이 중요하다.

하나의 항목의 값으로 몇 가지 정해진 값을 사용하는 경우, `config/const.php`에 정의하기 보다는 enum을 사용하며, 특수한 변경을 수행하는 경우 enum 측에서 특수한 변경을 수행한 값을 반환하는 메소드를 정의하여 일관된 값의 변경을 사용할 수 있도록 코드를 만드는 편이 좋다.

### config의 장점

라라벨의 config 폴더에 정의된 php 값은 라라벨 애플리케이션의 시작과 더불어, 해당 값들이 세팅되어, 애플리케이션의 각 부분에서 이를 이용할 수 있도록 한다. 제공되는 환경에 따라 환경변수가 달라질 수 있으며, `env()` 함수를 그대로 사용하기 보다는, 애플리케이션 실행과 함께 `config`를 세팅할 때 값을 `env` 값을 `config`에 세팅하는 것이 좋다.

테스트 코드를 작성할 때, `config`의 항목 값은 런타임에서 변경 가능하기 때문에 손쉽게 설정 후 테스트 할 수 있다는 장점이 있다.

### config의 단점

애플리케이션의 코드 실행에 따라, 값이 변할 수 있다. 물론 이 값을 변경하기 위해서는 `Config::set()`과 같은 특수한 함수를 써야하므로, 전역 변수에 값을 담는 경우와 달리 실수로 변경하지 않도록 하지만, 변경된 값이 어떤 로직에 의해 달라졌는지 변경을 추적하기 어려워 질 수 있다는 문제가 있다.

## 전역 상수의 문제점

PHP에서는 전역 공간에 const 키워드를 통해서 글로벌 상수를 정의할 수 있다. 이 값은 런타임에 변경하거나 환경별로 다른 값을 정할 수 없는 코드에 고정된 정적인 값이기 때문에 식별 값 변경을 할 수 없다는 단점이 있다.

이 케이스는 코드 기반에 의존하는 값으로 애플리케이션의 버전과 같은 케이스에 사용하기 적당하다.

PHP 문법을 사용하여 전역 상수를 정의할 때는 `bootstrap/app.php` 쪽에 글로벌 상수를 정의하거나, `include`로 정의한 글로벌 상수 파일을 불러와 실행하도록 하는 편이 좋다.

## 클래스 사용하기

클래스의 멤버로 const나 readonly를 사용하여 전역 값을 세팅하는 방법을 생각할 수 있다. 유사한 설정을 클래스로 묶어서 이해하기 쉽게 하며, `config` 쪽이 IDE에 의한 코드 이동을 할 수 없는 것에 반해, IDE에 의한 정의된 코드 위치로의 이동 및 정적 분석 툴에 의한 추론이 가능하도록 한다는 장점이 있다.

이런 이유로 개인적으로 `config`의 설정은 과거의 유산으로 보며, 클래스나 enum을 사용하여 애플리케이션의 각종 설정 값 및 상수를 관리하는 편이 좋다고 생각한다.

`const`의 경우에는 코드 기반으로 정의되어 런타임에서 변경할 수 없는 값을 사용하는 것에 반해, `readonly`의 경우에는 런타임임에 변경을 할 수 있다는 장점이 있다. 또한 `config`나 전역 변수가 애플리케이션 실행과 동시에 반드시 코드가 실행되는 것과 달리, `import`를 해서 사용해야 하기 때문에 필요할 때만 코드를 로딩하여 리소스 관리가 가능하다는 장점이 있으며, 한 번 사용한 이후 변경이 없는 동일한 값을 계속 이용할 수 있도록 `static readonly` 키워드를 사용한 싱글톤 코드를 사용할 수도 있다.
