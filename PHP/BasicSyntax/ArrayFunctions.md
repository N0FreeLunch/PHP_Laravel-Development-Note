# php의 배열함수

## php 배열함수의 단점
- 대부분의 인기 있는 언어에서 배열에 관한 체이닝 함수는 필수적인 추세이다.
- 하지만 php에서는 기본적으로 제공되는 배열함수는 체이닝을 할 수 없다.
- php의 배열함수는 자바스크립트의 예와 같이 `[1,2,3,4,5].filter(e => e>=3).map(e => e+1)` 이렇게 체이닝을 하는 방법을 사용할 수가 없다.
- 배열 함수별로 인자의 구성이 저마다 다르다. 예를 들어 array_filter의 경우에는 첫 번째 인자가 배열, 두 번째 인자가 callable이다. 하지만 array_map의 경우에는 첫 번째 인자가 callable 두번째 인자가 배열이다. 대체 왜 이런 식으로 함수를 설계했는지 알 수 없는데 이런 일관성의 불일치는 php의 배열함수를 쓰는 사람들에게 굉장한 불편함을 준다.

## 체이닝을 하지 않고 인자 방식으로 넘기는 방식으로 만들 경우
```
array_filter(
    fn($x) => $x >= 3,
    array_map(
        fn($x) => $x+1,
        array_map(
            fn($x) => $x+1,
            [1,2,3,4,5]
        ),
    )
)
```
- 끔찍한 코드가 되기 때문에 이런 방식의 사용을 지양해야 한다. 그러면 배열함수를 어떻게 사용해야 할까?

## 배열 함수를 사용하는 베스트프렉티스
```
$array = [1,2,3,4,5];
$array = array_filter($array, fn($x) => $x >= 3);
$array = array_map(fn($x) => $x+1, $array);
$array = array_map(fn($x) => $x+1, $array);
```
- 변수에 값을 재할당 하는 방식으로 사용해야 한다.
- 뒤에서도 살펴 보겠지만 php에서는 이런 방식의 사용이 배열 함수를 사용함에 있어서 가장 깔끔한 코드를 만든다.

## pipe 연산자 RFC 거부
```
[1,2,3,4,5]
|> fn($x) => array_filter($x, fn($x) => $x >= 3),
|> fn($x) => array_map(fn($x) => $x+1, $x),
|> fn($x) => array_map(fn($x) => $x+1, $x)
```
- 이런식으로 파이프 연산자를 도입해서 array_function의 체이닝을 할 수 있는 방식도 도입 되지 않았다.
- 파이프 연산자를 도입하면 그나마 쉽게 만들 수 있지만, 만약 도입한다고 해도 php의 기본 배열함수는 함수로 한 번 레핑을 해야 사용할 수 있는 단점이 있다.

## 꼭 체이닝을 하고 싶다면?
```
array_reduce(
    [
        fn($x) => array_filter($x, fn($x) => $x >= 3),
        fn($x) => array_map(fn($x) => $x+1, $x),
        fn($x) => array_map(fn($x) => $x+1, $x)
    ]
, fn($x, $y) => $y($x), [1,2,3,4,5]);
```
- 이렇게 좀 불편하게 체이닝을 할 수는 있지만, 보일러 플레이트가 많은 단점이 존재한다.
- 이렇게 사용하는 것은 코드가 길어지고 해당 표현에 관한 지식이 있어야 하는 등 여러모로 불편한 점을 야기한다.


## 지연평가 사용 불가
- 지연 평가란 f(x)의 결과를 y라고 할 때 이 결과에 g(y)와 같이 g함수를 사용해서 결과 값을 얻는 것이다. 하지만 연산한 결과에 연산한 결과에 연산한 결과를 넣는 것 보다 함수를 한꺼번에 묶어서 연산을 하는 방법이 있다. f·g 를 만들고 f·g(x)로 실행하여 결과 값을 얻는 것이다. 함수를 묶어서 실행할 수 있기 때문에 함수의 조합으로 하나의 도메인 로직 모듈 또는 기능의 단위를 묶어서 사용할 수 있어서 지연평가는 함수형 프로그래밍에서 아주 중요한 역할을 한다.
- 지연평가를 사용하기 위해서는 커링 가능한 함수를 만들어야 한다. 왜냐하면 일부 인자를 넣고 인자가 다 찰때까지 실행되는 것이 아니라 함수 자체로 존재해야 하기 때문이다.
- php의 기본 배열함수에 적용하기 위해서는 기존 함수를 변경할 수 있어야 하는데, 디폴트 배열함수는 변경 시도 자체가 불가능하기 때문에 사용할 수 없으며 지연평가를 위한 커링 함수를 만들기 위해서는 기본 배열함수를 변경 하는 것이 아닌 레핑을 해서 새로운 클로저를 만들어야 한다.



## Reference
- https://www.php.net/manual/en/ref.array.php
