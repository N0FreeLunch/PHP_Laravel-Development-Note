# 타입 주도 설계

## 대수적인 프로그래핑

대수학이란 직접적인 수를 대신한 문자를 사용해서 어떤 식을 만드는 것을 의미한다. 수를 대신한 문자를 통해서 수들 간의 관계성을 나타낼 수 있고, 방정식을 만들면 특정 수의 범위에 대해 특정한 관계성을 만족한다는 것을 표현할 수 있다.

프로그래밍에서도 대수란 변수의 범위에 대해서 각각의 시그니처의 코드들의 연관 관계를 통해서 어떤 로직의 변수들 간의 관계성을 만들어 낼 수 있다. 수학에서 변수의 범위가 자연수, 정수, 소수, 음의 정수, {x | x는 ... 조건}, a <= x < b 등으로 나타낼 수 있는 것에 반해서, 프로그래밍에서 대수의 범위는 타입이란 것으로 타나낸다.

### 좀 더 엄밀한 정의

대수를 영어로는 argebric이라고 하는데, 카테고리 이론에 기반을 두고 있는 수학적인 개념이다.

카테고리를 프로그래밍 언어에서는 타입으로 표기하고, 변수의 값은 하나의 타입이지만 변수가 가지는 타입의 범위가 두 가지 이상인 경우를 타입의 합으로, 변수가 가지는 타입이 둘 모두의 타입으로 구성되어 있으면 곱으로 본다.

#### 합 타입과 곱 타입의 예

- 유니온 타입 (합 타입) : A 타입 또는 B 타입 또는 C 타입의 여러 타입으로 하나의 변수를 나타낼 수 있다.
- Enum 타입 (합 타입) : Enum의 각 case는 하나의 타입이다. 하나의 Enum은 여러 case로 구성되어 있고 이들 case 중 하나가 변수의 값이 된다. Enum의 하나의 case는 값이자 타입이다.
- 튜플 (곱 타입) : 튜플은 php의 배열과 유사하지만 데이터의 길이가 정해져 있고, 각 원소를 구성하는 타입이 정해져 있으며, 선언된 값을 변경할 수 없는 특성을 가진 대상이다. 예를 들어 `[Person, Company]`으로 타입이 구성되어 있다면 `Person` 타입과 `Company` 타입이 하나의 원소를 구성하고 이들을 베이스로 한 값 `[Person1, Company1]`, `[Person2, Company2]`, `[Person3, Company3]`... 원소의 집합이 튜플으로 여러 타입이 복합적으로 하나의 값을 만든다.

## 타입리스 언어의 문제

타입이 없는 언어의 문제는 코드가 처음 생성된 부분부터 데이터가 어떻게 변했는지를 추적해야 한다.

타입을 사용하면 값의 생성을 처음부터 추적하지 않고, 코드의 일부분만으로 변수가 가진 타입을 알고, 해당 타입에 대한 로직을 만들면 되기 때문에 코드를 해석하는데 피로도가 줄어든다.

## 타입을 사용하는 것의 장점

컴파일러 및 정적 분석은 타입 검사를 한다. 이는 런타임에 직접 실행을 하지 않고서도 코드에서 타입 문제가 있다는 것을 알려준다.

런타임의 코드 실행은 모든 분기 및 조건에 대한 코드의 실행을 해봐야 하지만, 타입을 사용하면 타입간의 상위 하위 타입의 관계 및 코드에서 타입에 대한 모든 분기 처리 및 특정 타입을 받는 파라메터에 잘못된 타입이 전달 될 수 있는 코드를 알려 준다.

컴파일러 및 정적 분석으로 분석 가능한 코드를 만든다면, 코드의 타입만을 검사하여 타입 안정적인 코드를 작성할 수 있다.

### 타입리스의 변경 취약성

타입이 없는 동적 언어의 경우, 전체 코드의 타입을 검사하지 않기 때문에 코드를 변경했을 때, 시그니처 변경이 이뤄지면 이를 사용한 모든 코드를 실행해서 오류가 발생하지는 않는지 확인을 해야 한다.

반환값이 A와 B라는 두 타입에서 A와 C라는 두 가지 타입으로 변경 했을 때, 연결되는 코드는 A와 B에 대한 처리를 하기 위해 분기문을 구성해야 하는 것에서 B에 대한 처리 로직을 지우고 C에 대한 처리 로직을 만드는 작업을 해야 한다. 만약 연결되는 코드를 변경하지 않는다면, 타입이 있는 언어는 컴파일러나 정적 분석 툴은 문제가 있다고 지적하지만 타입이 없는 언어는 테스트 코드를 실행하거나 연관된 모든 코드를 실행해야 한다. 이 때문에 테스트 코드 및 테스트 커버리지가 중요해서 테스트 커버리지를 80~90%으로 만들기도 한다.

## 하나의 변수가 가질 수 있는 타입

변수는 대수적인 특징인 값의 범위를 갖는다. 기본적으로 값의 범위는 타입으로 나타내고, 동적 타입 언어에서 타입을 추가한 경우 하나의 변수는 여러 타입을 가질 수 있다. (이를 유니온 타입이라고 한다.)

유니온 타입이 없는 언어라고 하더라도 상속 관계를 통해서 포함 관계를 만들 수 있기 때문에 하나의 변수가 여러 타입을 갖는 것을 표현할 수 있다.

## 타입이 강력한 언어들의 특징

#### 정적 분석이 강력한 언어

타입이 강력한 언어는 일반적으로 컴파일 언어로 컴파일 시간이 많이 걸린다. 타입스크립트는 동적 언어에 고급 타입이론을 적용했지만, 언어에 타입을 부여하기 위해서 장황한 코드를 추가적으로 적어 주어야 한다.

타입스크립트는 ESlint와 같은 정적 분석에 여전히 의존적인 부분이 크며 정적 분석에서는 감지하지 못한 타입 에러를 컴파일러가 감지하는 등 정적 분석은 완전하지 못한 부분이 때때로 나타나기도 한다.

#### 강력한 컴파일러가 있는 언어

코틀린과 같은 언어는 강력한 타입을 가지고 있고 표현력이 풍부한 문법 및 내장 라이브러리를 가지고 있다. 언어가 강력한 대신 컴파일 시간이 훨씬 많이 걸리는 문제가 있다. 코드를 작성하고 빠르게 확인을 하는 것은 개발에 있어 중요하다. 코틀린은 컴파일 시간이 많이 걸리는 문제를 타입을 적극적으로 활용한 코딩을 통해서 극복할 수 있다. 강력한 타입을 통해서 런타임에서 발견되는 오류를 최소화하는 것이다. 이 외에도 전체 코드가 빌드되어 있다면 변경된 부분과 그에 영향을 주는 코드만 빌드하는 방식으로 컴파일 속도를 늘린다. 또한 유닛 테스트를 통해서 라이브러리 및 전체 프로젝트를 빌드하지 않고 일부 코드만 빌드하여 컴파일 속도를 높일 수 있다.

## 타입이 강력한 언어의 문제

타입은 그 자체로 항상 강력하고 문제가 되지 않는다. 하지만, 강력한 타입 체계를 가진 언어일수록 컴파일하는 시간의 문제, 타입으로 인한 코드의 장황성 문제, 컴파일 시간으로 인한 런타임 확인이 늦어지는 문제를 가지고 있다.

프로그래밍의 로직은 타입만으로 해결할 수 있지 않다. 타입은 어디까지나 타입이 가진 범위를 통해서 코드와 코드 간의 잘못될 가능성이 있는 부분을 찾아내어 이를 고칠 수 있도록 하지만, 모든 로직 에러를 고쳐주지 않는다. 로직 에러는 애초에 잘 생각을 해서 코드를 작성하거나 런타임의 실행된 결과와 작성된 코드의 관계를 분석하면서 문제를 해결하는 경우가 많다. 짧은 단위의 피드백을 반복하는 것이다.

### 웹 프로그래밍

웹 프로그래밍은 서버로 전달되는 각종 값들에 대한 벨리데이션 처리를 하고 이들 값을 이용해야 하는 분야이다. 각종 값들의 벨리데이션은 타입을 분석하는 것으로는 해결할 수 없는, 런타임에 직접 코드를 실행해서 문제를 해결하는 수 밖에 없는 부분이다.
