## 에러의 원인을 발견할 수 있는 로직 만들기

## 흔히 하는 실수
- 초보 개발자들이 흔히 하는 실수는 에러를 만들지 말아야 한다는 관념에 사로잡힌 것이다. 하지만 의도하지 않았던 로직이 발생했을 때는 에러가 나도록 만들어야 좀 더 안전하게 프로그램을 가꿀 수 있다.

## 왜 에러가 나도록 프로그래밍 해야 하는가?
- 에러가 발생하는 것은 의도하지 않은 로직의 전개가 일어나는 것을 의미한다. 
- 의도하지 않은 로직이 발생했을 경우 가능한한 에러가 나고 에러를 보고하도록 하여 계속되는 문제를 미연에 차단하는 로직이 필요하다.

## 에러가 나는 프로그래밍 보다 더 중요한 것
- 의도하지 않은 로직이 일어날 가능성을 원천적으로 막을 수 있는 프로그래밍을 할 수 있어야 한다.
- 가능한한 의도하지 않은 로직의 일어날 가능성을 막고 혹여라도 의도하지 않은 로직이 일어났다면 에러가 날 가능성을 남겨두는 것이 필요하다.
- 의도하지 않은 로직에 대해서 에러가 일어나지 않도록 짜는 것은 잘못된 로직에 대한 피드벡을 받을 수 없게 하므로 항상 에러나 나지 않는 로직을 만드는 것이 옳은 것이 아니다.

## 어떻게 에러를 나게 할 것인가?
1. 타입을 사용하여 데이터의 형식을 제한한다.
2. 변수 이름을 명확하게 지어주기
3. 변수의 타입을 명확하게 체크하기
4. 타입힌트를 사용하여 코드 작성하기
5. 함수를 사용하여 코드 작성하기
6. 객체를 사용하여 코드 작성하기
7. 때로는 데이터가 정의 되었는지 정의되지 않았는지 체크하는 로직을 만들어야 할 때와 만들지 말아야 할 때
8. 의도한 로직 이외의 동작을 할 때는 에러가 날 수 있도록 만든다.

### 타입 사용하기
- 어떤 타입을 사용할지 명확하게 정의한다. 타입을 정의하는 것은 다른 형식의 데이터가 들어갈 경우 에러가 발생하게 되므로 잘못된 데이터가 들어갈 수 있는 여지를 어느정도 방지한다.

### 변수 이름을 명확하게 지어주기
- 변수가 어떤 역할을 하는지를 적어주는 것도 중요하지만 변수가 가질 수 있는 범위를 예측할 수 있게 만들어 주는 것도 필요하다.
- 예를 들어 `$date`라고 했을 때 어떤 종류의 포멧인지 모를 수 있다. 그럴 경우 `$yyyymmdd`와 같은 방식으로 적어주면 값의 포멧이 어떤지 알 수 있으므로 더 좋은 변수명이 될 수 있다. `$date`라고 했을 때는 포멧에 관계없이 다양한 날짜값을 받을 수 있는 경우라고 할 수 있다. 예를 들어
```
public function setDate($date): self
{
    try {
        $this->date = Carbon::parse($date);
    } catch($e) {
        throw new \Exception('date format error');
    }
    return $this;
}
```

### 변수 타입을 명확하게 체크하기
- 코드에 어떤 타입인지 명확하게 체크하는 로직을 만든다. is_null, is_int, is_float... 등등을 이용하여 코드를 작성해서 어떤 시점에서 어떤 타입을 갖는지 명확하게 알 수 있도록 한다. 코드를 짤 때 어떤 타입의 값이 할당되는지 명확하게 알 수 있기 때문에 다른 로직을 짤 때 헤메지 않게 해 준다.
- 잘못된 타입이 들어가서 의도하지 않은 연산을 하게 될 여지를 줄여준다.

## 타입힌트를 사용하여 코드 작성하기
- php7.2 부터는 함수에 타입힌트를 지정할 수 있다. 함수의 파라메터와 함수의 리턴값에 타입힌트를 지정할 수 있다.
- php7.3 부터는 `?type` 형식으로 nullable 문법을 사용할 수 있다.
- php8 부터는 다중 타입 `int|string` 과 같은 방식으로 사용할 수 있다. 
- 타입을 사용한다는 것은 값이 가지는 범위를 줄일 수 있다는 장점이 있다. 따라서 잘못된 범위의 값이 들어 올 때 특정 타입 범위에 해당하는 값만 받아들이므로 예상하지 로직이 실행될 경우 타입이 달라진다면 에러가 발생하기 때문에 에러를 확인하고 오류를 개선할 수 있다.

## 함수를 사용하여 코드 작성하기
### 타입힌트
- php7에서는 함수의 매개변수와 리턴 값에 타입힌트를 지정할 수 있다.
```
public function method(int $arg1, bool $arg2): array
{
    return [$arg1, $arg2];
}
```
- 함수에 넣어진 인자의 타입이 다를 경우 에러가 발생하기 때문에 타입이 함수 내부에서 잘못된 연산이 일어날 가능성을 줄여 준다.
- 함수의 리턴값이 특정 타입으로 정해져 있기 때문에 함수를 사용한 연산을 구성할 때 함수의 리턴 값의 유형을 정확하게 알게되므로 예외 사항이 줄어든 더 정확한 연산 로직을 만들 수 있다.

### 에러를 줄이는 프로그래밍 - 사이드 이펙트 제거
- 가능한한 사이트이펙트가 없는 함수를 만들어 함수를 사용하는 것만으로도 결과를 추측하게 만드는 것이 좋다. 물론 경우에 따라 객체지향의 특성 의미를 살려 멤버 변수를 변경하는 방식으로 만드는 것이 간단할 수 있기 때문에 사이드 이펙트가 없는 함수를 만든다는 것은 가능하면 하라는 것.

### 에러를 줄이는 프로그래밍 - 의도치 않은 로직이 안 만들어지도록 코드를 작성하는 방법
- 함수의 명칭을 가능한한 어떤 기능을 하는 것인지 명확하게 정하는 편이 좋다. 함수 명만 보고 매개변수로 무엇을 지정할 수 있다면 가장 좋고, 비록 함수명으로 매개변수를 알 수 없더라도 매개변수의 타입과 갯수를 보고 함수의 명을 보면 어떤 연산을 하는 기능인지 알려주는 기능을 하도록 만든다.
- 함수가 어떤 기능을 담당하는지 쉽게 알기 위해서는 함수에 매개변수를 잔뜩 넣지 않는 방식을 사용해야 한다. 함수에 매개변수를 넣는다는 것은 인자의 값이 변경가능할 때를 의미한다. 맥락상 변경의 여지가 없고 이미 정해져 있는 데이터는 인자로 전달하지 않고 함수 내부에서 사용하도록 한다. 
- 함수의 인자가 많아질 경우를 대비해 기능을 함수단위로 만들기 보다 객체 단위로 만들자. php의 경우 함수형 프로그래밍 처럼 함수에 커링 기능을 이용하여 기능을 실행하기 위해 필요한 요구사항을 정의하는 것이 불편하기 때문에 객체를 사용하여 요구사항을 메소드로 정의하고 정의된 메소드를 사용할 수 있게 만들자. 객체가 하나의 기능을 담당하게 된다면 메소드도 하나에 많은 인자를 할당하는 방식을 벗어나 여러 메소드에 조금씩 인자를 할당하여 기능에 맞는 결과값을 얻는 방식을 사용할 수 있기 때문에 함수 각각의 기능을 명확하게 할 수 있다.

## 객체를 사용하여 코드 작성하기
### 타입힌트
- php7.4 부터는 객체의 멥버 변수를 선언할 때 타입을 지정할 수 있기 때문에 의도치 않은 다른 타입의 값이 멤버 변수에 할당되는 경우 에러가 발생한다. 이를 통해서 잘못된 값이 들어갈 여지를 방지할 수 있다.
- 다른 유형의 타입이 들어가 있는지 멤버변수에 사용하는 모든 코드를 전수조사 하지 않아도 어떤 값이 할당되는지 알 수 있게 한다. 타입보다 좀 더 정확한 범위를 지정하기 위해서 멤버 변수명도 타입에 맞고 의도에 맞는 것으로 지어주면 어떤 값이 들어가는지 멤버 변수에 할당되는 코드들을 확인하지 않아도 되기 때문에 좋다.
- 클래스에서 멤버 변수를 선언하면 기본적으로 `null` 값이 할당된다. `is_null` 문법을 통해서 멤버 변수의 할당을 체크할 수 있다.
```
public function method()
{
    if(!is_null($this->sampleObj)) $this->sampleObj->getValue();
}
```

## 데이터가 정의 되었는지 정의되지 않았는지 체크하는 로직을 만들어야 할 때와 만들지 말아야 할 때
### null의 역할
- null 체크는 일반적으로 데이터가 할당 되었는지 할당되지 않았는지 파악할 때 사용한다.
- 데이터가 할당되지 않았다는 의미로 null을 사용하는 것이 일반적이며, null을 하나의 값으로 취급하지 않도록 코딩에 주의해야 한다. null은 데이터의 할당이 일어나지 않은 것이므로 로직을 구성할 때 데이터 요구사항이 충족되어 있는지 확인하는 용도록 쓰이는 것이다. 
- 연산 로직에서는 미리 연산을 할 수 있게 데이터가 할당되어 있어야 하기 때문에 null이 들어간 데이터가 들어가면 안 된다. 연산 로직에 이르기 전에 미리 연산에 필요한 데이터의 할당을 체크하는 로직을 거쳐야 한다.
- 만약 반드시 실행되어야 할 연산로직에 선행되는 데이터가 할당되지 않은 경우에는 에러가 발생하도록 로직을 짜야 한다. 그래야 왜 데이터가 할당되지 않은 원인을 찾을 수 있기 때문이다. 하지만 할당되지 않은 경우에는 데이터에 접근이 안 되거나 null과 다른 타입간의 연산이 일어나면서 에러가 나게 되므로 데이터 할당 로직을 미리 짜지 않는 편이 생산성을 높일 수 있다.

### nullable
- 타 언어에는 var과 val 이라는 변수 선언 키워드가 있다. 

## 의도한 로직 이외의 동작을 할 때는 에러가 날 수 있도록 만든다.

