## 당신의 코드를 신뢰해야 할까요?

### 도입

프로그래머의 실수를 줄이는 언어가 인기이다. 동적 언어인 자바스크립트에 타입을 도입하여 정적인 특성을 갖춘 타입스크립트의 인기가 높아지고, 메모리 관련 버그를 미연에 차단하는 코딩 스타일을 강제하는 러스트의 인기도 높아지고 있다. 그 동안 생산성이 높다고 여겨진 동적언어가 IDE의 정적 추론의 발달로 버그로 인한 메인테인스까지 고려한다면 정적 언어도 동적 언어에 못지 않은 생산성을 가지는 시대가 되고 있다.

프로그래밍의 초보자들은 동적 언어를 선호하는데, 그 이유는 정적 언어가 갖는 여러 엄격함을 초보자들이 이해하기 어렵기 때문이다. 어떤 결과를 얻고자 하는데, 왜 실행이 되지 않는지, 왜 자신이 짠 코드는 빨간줄이 생기는지 등 코딩의 실수가 있어도 이를 어느 정도 무시하고 빠르게 실행해서 결과를 알아 볼 수 있는 언어가 초급 개발자들의 시장에서 인기이다. 하지만 이들 언어로 짠 프로그램은 어떻게든 동작하기 때문에 많은 버그가 양산이 되는데, 자신이 프로그래밍 과정에서 맞닥뜨린 결과를 확인하더라도 프로덕션에서 프로그램이 동작할 때는 개발자가 확인한 케이스 뿐만 아닌 다양한 케이스들에 대한 로직이 동작할 수 있고, 이를 충분히 테스트하지 않았다면 버그가 발생한다.

정말 초기의 MVP를 개발해야 하는 스타트업이 아니라, 괜찮은 프로덕션 서비스를 운용하고 있는 입장에서는 동적 언어의 사용을 피하거나, 동적 언어라도 타입제한이 엄격한 언어를 사용하는 경향이 있는데, 타입은 프로그래머의 실수를 줄여주기 때문이다. 물론 타입 제한이 약한 언어를 사용하는 대신 테스트 코드를 짜는 방향의 해결책을 사용하는 경우도 있을 것이다.

많은 경우 버그를 타입 제한을 통해 해결할 수 있고, 또는 프로그래밍 언어의 제한을 통해서 버그가 발생할 여지가 있는 코딩 스타일을 원천적으로 제한하는 방향으로 버그를 줄일 수도 있지만, 인간이 프로그램을 통제할 수 있는 코드를 짜는 것이 가장 중요하다고 본다.

### 어떤 문제가 발생하는가?

마치 보드 게임의 블럭이 빠진 젠가처럼, 코드를 건드리기만해도 고장날 위험성이 있는 아슬 아슬한 코드가 존재할 수 있다. 이런 코드 위에 무언가 기능을 추가하거나 코드의 동작을 변경할 때 버그가 발생할 위험성이 높아진다. 함수나 클래스로 잘 추상화하여 무엇을 사용하고 무엇을 사용하지 않는지를 캡슐화 하여 재사용하기 쉽고, 불필요한 코드의 변경을 하지 않는 등의 방식을 통해서 추후 해당 코드로 작업하는 사람들의 실수를 줄이고 안전하게 코드를 사용할 수 있도록 만드는 것이 중요하다. 하지만, 잘못된 추상화는 이해할 수 없는 어려운 코드가 될 수 있다.

실제 구현해야 하는 동작과 다르게 구현을 했지만, 검증 케이스가 적고, 검증하기 까다로워서 잘못된 구현임에도 사용되고 있는 코드가 있다. 당장의 문제가 발생하지 않더라도 나중에 문제가 발생할 가능성이 있고, 잘못된 구현이기 때문에 원래 어떤 의도로 작성해야 하는지 원래 의도된 사양을 재확인하고, 코드를 변경했을 때 해당 사양을 잘 만족하는지 확인하는 것이 중요하다.

### 신뢰할 수 있는 코드란?

일단 잘 동작하는 코드를 전제로 한다. 해당 코드를 재사용했을 때 의도한 대로 잘 동작해야 한다. 해당 기능 위에 무언가를 구축할 경우 버그 없이 잘 동작해야 한다.

리펙토링 대상 코드에 코드를 쌓는 것은 나중에 더 큰 리펙토링 비용을 초래한다. 책임이 잘 정해지지 않은 코드는 한 번에 여러 임무를 수행하기 때문에 작은 요구 사항의 변경이 해당 기능 전체에 영향을 줄 수 있고 이 때문에 이러한 코드 위에 코드를 쌓으면 쌓을 수록 더 리펙토링하기 어려운 코드가 될 수 있다. 따라서 각 기능의 책임이 잘 분리되어 있는지를 알아야 한다.

### 버그를 줄이는 코딩

#### 이해할 수 있는 코드 작성하기

많은 경우 버그가 발생하는 이유는 프로그래머가 코드의 동작을 충분히 이해하지 못하기 때문에 발생한다. 프로젝트에 참여하는 모든 사람들이 코드의 동작을 이해할 수 있어야 하며, 코드의 동작에 대한 충분한 이해없이 코드들 만드는 습관을 가진 사람이 있다면 이를 고쳐주기 위해 노력해야 한다.

#### 예측 가능한 코드 작성하기

보편적으로 이해할 수 있거나 남이 이해할 수 있는 코드를 만들 수 있도록 코드 스타일을 만들어 주어야 하고, 동작을 추상화 할 때는 어떤 동작이 일어날 것인지 추측 가능하도록 만들어 주어야 한다. 객체를 캡슐화 할 때는 앞바퀴가 굴러가면 뒷 바퀴도 굴러가도록 코드를 작성해야 하며, 함수를 만들 때는 함수의 인풋으로 인한 결과를 예측할 수 있도록 만들어져야 한다.

#### 도메인 로직과 유사한 코드 작성하기

도메인 로직에 맞게 코드의 전개 방향이 일치해야 하며, 코드의 전개 과정에서 흐름에서 동떨어진 코드가 발생하지 않도록 코드를 관리 해 주어야 한다. 또한 각각의 함수나 클래스의 동작에서 지시한 기능이 아닌 다른 동작이 일어나지 않도록 코드를 짜 주어야 한다.

#### 인지적 부하 줄이기

언어나 라이브러리의 모든 사양과 기능을 알지는 못한다. 코드를 줄줄이 나열하는 것 보다는 함수나 클래스 등을 추상화를 이용해서 어떤 기능인지 의미론적으로 전달할 수 있도록 하는 것이 좋다. 언어에 내장된 함수나 클래스 또는 잘 알려진 라이브러리를 이용하면, 이미 잘 정의된 시그니처의 클래스 또는 함수를 사용할 수 있기 때문에 개개인이 필요할 때마다 직접 시그니처를 정의하는 것 보다 나을 수 있다.

### 개발 프로세스

#### 워터풀

워터풀은 미리 전체 프로그램의 개요에 대한 사항을 정하고, 애자일은 각 사람에게 작업을 맡기는 방식을 채택한다. 프로그램의 복잡성이 높아질수록 세부 구현을 확인하지 않으면 시스템의 동작을 파악하기 어려춰 워터풀 방식으로는 해결책을 찾기 어려울 수가 있다. 담당하는 각자가 기존의 코드를 올바르게 판단하여 코드를 만드는 역량을 요구하게 된다.

다른 사람의 코드를 신뢰할 수 없는 문제가 발생하는 것으로 인해, 각자에게 코드의 변경을 맡기는 것이 문제가 되는 경우, 어느 정도의 설계 방향성에 대해 정하고 요구하고 구현을 맡기는 편이 나을 수 있다.

#### 애자일

애자일을 할 때 특히 코드의 퀄리티가 중요한데 그 이유는 어떤 피쳐를 개발하는 각각의 사람이 올바른 판단을 할 수 있도록 코드로 시스템에 대한 정보를 최대한 제공 할 수 있기 때문이다. 계속적인 시스템의 변화가 생긴다면 그 때 그 때 모든 사양서를 업데이트 하는 것은 어려울 수 있다. 애자일은 변화에 강한 시스템을 만들어야 하므로 코드로 가능한 정확한 기능과 도메인에 대한 이해를 도울 수 있도록 만들어야 하며, 도메인 주도 개발이 애자일에서 중요한 위치를 차지하는 이유이기도 하다.
