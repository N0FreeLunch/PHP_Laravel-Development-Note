# 테이블 디자인

## 테이블의 구성

테이블은 데이터를 저장하여 쌓는 곳이다. 테이블은 컬럼이라는 속성으로 구성되어 있다. 데이터의 특징을 결정 짓는 요인은 테이블과 컬럼이다.

## 테이블을 어떻게 정의해야 할까?

### 생성 삭제 단위로 만들기

테이블은 생성 및 삭제가 좋은 단위로 만드는 것이 좋다. ORM을 사용하면 연관 모델에 접근한다.

```php
$model->relationModel->delete()
```

(기본키 외래키로 연결되어 있는) 연관 모델에 접근할 때 한 단위로 삭제를 하고

```php
if (is_null($model->relationModel)) {
    $model::newModelInstance()->setter()->save();
}
```

데이터가 존재하지 않을 때, 데이터를 추가할 수 있도록 만들면

컬럼 간의 조건을 파악하는 복잡한 조건의 체크 없이 데이터의 삭제 및 생성을 간단하게 만들 수 있다.

## 하나의 테이블에 너무 많은 컬럼을 정의

### 테이블 추가 작업의 보일러 플레이트

Raw SQL으로 테이블의 스키마를 정의하는 것은 의외로 까다로울 수 있다. 테이블을 추가하면 매핑되는 ORM 클래스도 추가해야 하는 등 세팅하는데 시간이 소비된다. 이 때문에 별도의 테이블로 분리하여 관심사를 나누어야 함에도 불구하고 그냥 컬럼을 추가하여 정의하는 경우가 있다.

### 컬럼 정렬의 문제

특정 컬럼을 기준으로 정렬해야 하는 경우, 메인 모델의 컬럼은 정렬 할 수 있는 반면, 연관 모델의 컬럼은 정렬하기 어렵다는 문제가 있다. 검색 조건에 따라 연관 모델의 컬럼을 기준으로 정렬하려고 할 때는 메인 연관 모델을 메인 모델로 두는 등의 쿼리의 조건 변경이 아닌, 메인 모델과 연관 모델의 관계를 바꾸는 등의 코드의 조건 변경이 필요하기 때문에 코드가 까다로워진다는 문제가 있다.

이런 경우에는 조인, 서브쿼리, 뷰 등을 정의하는 방식으로 생각해 볼 수 있는데, ORM을 사용할 때는 서브쿼리를 이용한 정렬 방식을 사용하는 것을 추천한다.

조인의 경우에는 ORM 모델에 조인 절을 결합해야 해서 테이블 이름 등의 로우쿼리에 의존하는 문제 및 모델에 정적으로 정의되지 않은 컬럼에 접근해야 하는 등의 문제가 있다.

뷰 테이블의 경우에는 뷰를 위한 별도의 컬럼을 만들어야 하는데, 뷰 테이블을 만들 때는 DQL(데이터 질의어)을 사용해야 한다. DQL을 사용하면 뷰 테이블을 구성하기 위한 스키마가 로우 쿼리에 의존하게 되어, 변경하기 어려운 코드가 될 수 있다는 문제가 있다.
