# 서비스 클래스

많은 프레임워크에서 서비스 객체는 싱글턴으로 만든다. 이는 애플리케이션이 한 번 기동한 후 여러번 그리고 다양하게 데이터를 처리하는데, 컨트롤러, 유즈케이스, 서비스 클래스는 반복적으로 사용하기 때문에 한 번 객체를 애플리케이션에서 띄워준 후 클래스를 인스턴스화 하지 않고 계속 재사용을 하기 위해서이다.

## php에서는?

php는 기본적으로 CGI로 동작한다. 일련의 작업이 갖는 라이프 사이클을 하나의 프로세스가 처리하기 때문에 한 번에 모든 컨트롤러, 유즈케이스, 서비스 클래스를 싱글톤으로 만들어 놓으면, 애플리케이션 기동시에 모두 실행이 되기 때문에 애플리케이션의 부트스트레핑 시간이 늘어난다.

기본적으로 php와 같은 CGI 방식의 프로세스를 사용하는 애플리케이션에서는 부트스크레핑을 최소화하기 위해서 꼭 싱글턴으로 사용해야 하는 컨트롤러, 유즈케이스, 서비스 클래스만을 선택적으로 사용하고, 라우터의 정의에 따라 사용할 대상 컨트롤러의 경로만 실행하게 하여 부하를 줄이는 것이 좋다.

## 애플리케이션 재사용하기

Roadrunner, FrankenPHP 등을 사용해서 라라벨 옥테인을 사용하는 경우에는 한 번 기동된 애플리케이션이 수 많은 리퀘스트를 처리한 후 종료된다. 이 때는 애플리케이션의 부트스트레핑에 가능한 많은 컨트롤러, 유즈케이스, 서비스 클래스 등을 싱글톤으로 올려 두고 객체 인스턴스를 최소화하는 방식으로 코드를 실행하도록 할 수 있다.

## Stateless

다수의 독립된 처리를 하나의 라이프 사이클에서 처리하는 애플리케이션의 경우 메모리 릭을 방지하기 위해서, 컨트롤러, 유즈케이스, 서비스 클래스에 객체의 상태를 부여하지 않는 방식의 코딩이 권장된다.

하지만 CGI 방식을 사용하는 경우에는 객체에 상태를 부여하는 것이 그렇게 문제가 되지는 않는다. 다만 객체의 상태를 부여하는데 단일 setter가 아닌 여러 setter를 사용하는 경우 객체의 상태 세팅에서 실수가 발생할 수 있기 때문에 권장되는 코딩 스타일은 아니다. 생성자를 사용하여 객체의 상태를 세팅하는 것이 좋지만, IOC로 의존성 주입이 이뤄지는 경우 직접 생성자에 값을 전달할 수 없기 때문에 상태의 세팅이 필요한 경우 단일 setter를 상용하도록 한다.
