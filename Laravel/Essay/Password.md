# 비밀번호

각 유저 어카운트별로 비밀번호를 재 설정하는 방법을 추가할 필요성이 있다.

## 비밀번호 규칙

일반적으로 비밀번호 규칙은, 영어 대소문자 숫자를 반드시 한 문자 이상을 넣어 만들도록 강제한다.

보통은 최소 12문자 제한을 걸도록 한다. 좀 더 길어도 좋다.

특수문자를 입력할 수 있도록 한다.

## 멀티바이트 문자 제한

기본적으로 비밀번호의 구성은 키보드로 일력할 수 있는 문자여야 한다.

키보드로 입력할 수 있는 문자들로 구성된 정규 표현식을 만들도록 하자.

멀티바이트 문자는 통제되기 어렵고 정규식을 작성하기도 까다롭다. 기본적으로 키보드로 입력할 수 있는 문자를 사용하돼, 특수문자의 경우, 허용할 특수문자를 화이트리스트로 정한다.

## 웹 상에 비밀번호 노출하지 않기

비밀번호는 특수문자를 포함한다. 따라서 웹 상에서 이들 문자가 표기될 때, 이스케이프처리를 하지 않으면 보안 위험이 일어날 수 있다. 기본적으로 비밀번호는 표기할 일이 없도록 하자.

## 해쉬화된 비밀번호 표기하지 않기

비밀번호 변경 창에 해시화된 비밀번호가 노출되는 경우가 있을 수 있다. 해시값을 노출하지 않는 것은 기본중의 기본이지만, 데이터베이스의 특정 레코드의 컬럼 값을 폼 태그와 연동한 라이브러리나 공통 기능을 사용했을 때 부주의한 사람에 의해 해시값을 노출하는 코드를 작성하는 경우가 있다.

해시값을 노출하는 것은, 암호화된 비밀번호를 그대로 클라이언트에 노툴하는 것이고, 비밀번호를 저장한 데이터베이스가 해커에게 털렸을 때 비밀번호 변경을 요구하는 것 처럼 비밀 번호를 변경해야 할 정도의 일이 될 수 있다.

## 해시화된 비밀번호를 통한 성공율 높은 레인보우 테이블 생성

일반적으로 웹에서 자주 쓰이는 비밀번호 관련 암호화 기술은 bcrypt, Argon2이다. 저장된 비밀번호를 결정하는데는 해시화된 비밀번호, 암호화에 드는 비용인 cost, 해시를 결정하는데 필요한 고유값인 salt가 존재한다.

이 세 요소, 평문 비밀번호, cost, salt 값이 일치하면 저장된 비밀번호를 얻을 수 있다. bcrypt, Argon2 등으로 저장된 값에는 cost, salt, 평문 비밀번호의 해시가 연결된 문자열로 저장되어 있다. cost는 비용이기 때문에 대부분의 유저가 일치하는 cost 비용을 사용하지만, salt는 저장된 비밀번호가 누출되더라도 다른 유저의 해시 값을 추측할 수 없도록 유저별로 저장된다.

하지만 저장된 비밀번호가 유출되면 cost, salt 값을 통해서 해시화된 비밀번호를 생성하는 평문 비밀번호가 될 수 있는 대상 리스트를 얻을 수 있고 이를 통해서 부정 로그인이 이뤄질 수 있다.

## 클라이언트가 자리를 비우는 것을 생각하자.

클라이언트가 자리를 비웠을 때, 다른 사람이 패스워드 변경 화면 등에 접근해서 계정을 탈취하는 등의 일을 할 수 있다는 것을 염두해 두어야 한다.

이를 위해서 패스워드 변경 항목을 사용할 때는 기존 패스워드를 입력하는 방식 또는 메일 등으로 비밀번호를 전송하는 방식 등을 사용해야 한다.

## 최소한의 보안 단계를 어느 정도 생각할까?

개인에 대해 제공되는 서비스의 경우, 일반 유저가 자리를 비웠을 때 이뤄질 수 있는 계정 탈취 시도를 방어해야 한다. 개인의 경우 계정이 탈취될 경우, 복구할 수 있는 수단이 제한될 수 있기 때문에 가능한 탈취가 이뤄지지 않도록 엄격하게 다뤄져야 한다.

기업에 대해 제공되는 서비스의 경우, 관리자가 계정에 대한 복구 및 리셋을 할 수 있기 때문에 개인에 대해 제공되는 서비스의 경우 보다는 덜 엄격해도 복구에 있어서는 쉽지만, 계정의 복구까지 이뤄질 수 있는 각종 정보 변경으로 인한 기업의 손해를 방지하기 위해서는 계정 탈취 시도가 이뤄지지 않도록 서비스를 제공하는 것이 필요하다.

## 구현

### 폼 태그

기존 비밀 번호를 표기할 때는 다음과 같은 태그를 사용한다. 이 때 value 값으로 해시 값을 넣지 않는다. 클라이언트에 의해 해쉬화된 코드가 파악되지 않도록 설정된 비밀번호를 표기할 때는 `************`와 같이 같은 문자를 `value` 값으로 넣는 방법을 사용할 수 있다.

```
<input type="password" id="pass" name="password" minlength="12" value="************" />
```

리퀘스트로 비밀번호가 *으로만 이뤄진 문자가 전달되었을 경우, 비밀 번호 변경을 하지 않는다.

## 벨리데이션 전략
