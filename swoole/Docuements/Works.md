## swoole의 특징

### 코루틴 사용
- 코루틴을 사용하면 콜백 지옥의 방식을 피할 수 있는 점이 장점이다.

### 스테이트풀 서버
- PHP에서 스테이트리스는 CGI 방식의 프로세스를 실행하는 것이다. CGI로 PHP 프로세스를 실행하고 종료 되면 해당 프로세스가 가진 메모리 저장 정보는 사라진다. 물론 외부 데이터베이스에 데이터를 저장하는 방식을 사용한 경우를 제외한 순수 PHP 프로세스의 방식에 한정한다.
- swoole은 CGI 방식으로 프로세스를 켰다가 종료하는 방식이 아니라, 하나의 프로세스를 켜서 여러 통신 리퀘스트와 작업을 처리하는 역할을 한다.
- 라이브러리나 프레임워크를 사용할 경우, 라이브러리의 코드 및 프레임워크의 코드를 올리고 비즈니스 로직을 처리 해야 한다. CGI 방식은 리퀘스트가 들어 올 때 마다 계속적으로 라이브러리나 프레임워크의 코드를 올리고 비즈니스 로직을 실행해야 반대로 스테이트풀 방식의 프로세스를 사용하면 한번 라이브러리나 프레임워크 위에 코드를 올리고 나면 통신이 들어 올 때 마다 비즈니스 로직을 위한 코드만 실행하면 된다. 따라서 통신 레이턴시를 단축할 수 있으며 시스템의 리소스도 절약할 수 있는 장점이 있다.

### 프로세스가 서버 역할을 함
- CGI 방식의 경우 계속 켜져 있는 프로그램이 하나 있어야 한다. 왜냐하면 CGI는 리퀘스트를 처리하기 위해 하나의 프로세스를 켜고 필요한 로직 처리를 하고 프로세스를 종료하기 때문에 통신을 받아주고 프로세스를 실행하기 위한 트리거 역할을 하는 상주 프로그램이 존재해야 한다.
- swoole의 경우는 php 프로세스 자체가 종료되지 않고 상주하기 때문에 리퀘스트를 그대로 받아서 처리할 수 있는 기능을 가질 수 있다. 따라서 CGI 방식을 사용하는데 필요한 PHP-FPM과 같은 툴이 필요없다.

### swoole의 특징
- 다중 프로세스를 활용하는 프로그래밍
- 이벤트 중심의 설계가 가능
- 비동기식 설계로 구현
- 고성능의 엄청난 네트워킹 처리량은 다중 CPU 코어, 작업자 프로세스 및 코루틴의 동시성을 활용하여 달성

### swoole과 php-fpm의 차이
- TCP, UDP, UnixSocket을 지원
- epollOpen 또는 kqueue를 사용한 논블록킹 I/O 모드를 사용
- 모든 CPU 코어를 활용하기 위해 CPU 코어 번호를 기반으로 여러 워커 프로세스를 분기한다.
- WebSocket 서버 또는 TCP/UDP 서버에 대한 Long-live 연결을 지원한다.
- 더 많은 서버 측 프로토콜을 지원합니다: TCP/UDP/HTTP/HTTP2/WebSocket
- PHP 파일을 메모리에 미리 로드한다.
- PHP Swoole 메모리 관리 모듈 을 사용하여 메모리의 상태를 관리하고 재사용할 수 있다.

### swoole 서버 구성요소의 용어
- 마스터 프로세스 : woole 서버의 첫 번째 진입점, 이벤트 루프를 시작한다. 타이머 이벤트의 처리를 담당한다.
- 마스터 프로세스의 리액터 스레드 : 서버와 클라이언트 간의 통신을 담당하는 I\O를 처리하기 위해 마스터 프로세스에서 생성됨
- 메니저 프로세스 : 워커 프로세스를 관리하는 메니저 역할, 워커 프로세스 및 태스크 워커 프로세스를 생성하거나 파괴하는 역할을 가지고 있으며, 워커 프로세스가 실패하면 다시 실행하는 역할을 한다.
- 워커 프로세스 : 주요 비즈니스 로직이 실행되는 곳. 애플리케이션 코드가 동작되는 부분이다. Reactor 스레드에서 데이터를 수신하고 비즈니스 로직을 실행한 다음 Reactor 스레드에 응답을 다시 보내는 기능을 한다.
- 테스크 워커 프로세스 : 실행중인 이벤트 루프 또는 코루틴을 차단하는 코드를 해제(offload)하는데 사용한다. 워커 프로세스에서 데이터를 받고 처리 결과를 워커 프로세스로 보낸다. 워커 프로세스는 작업자에게 데이터를 보낸다.

### 워커 프로세스에서 테스크 워커 프로세스로 데이터를 보내기
```
Swoole\Server->task
Swoole\Server->taskCo
Swoole\Server->taskwait
Swoole\Server->taskWaitMulti
```

### 테스크 워커 프로세스에서 워커 프로세스로 데이터 보내기
```
Swoole\Server->finish
```

## Reference
- https://openswoole.com/how-it-works

